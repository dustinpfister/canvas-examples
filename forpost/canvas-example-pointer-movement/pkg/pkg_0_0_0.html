<html><head><title>canvas example pointer movement</title></head><body>
<div id="canvas-app"style="width:320px;height:240px;margin-left:auto;margin-right:auto;"></div>
<script>var PM=(function(){var distance=function(x1,y1,x2,y2){return Math.sqrt(Math.pow(x1-x2,2)+Math.pow(y1-y2,2));};var getCanvasRelative=function(e){var canvas=e.target,bx=canvas.getBoundingClientRect();return{x:(e.changedTouches?e.changedTouches[0].clientX:e.clientX)-bx.left,y:(e.changedTouches?e.changedTouches[0].clientY:e.clientY)-bx.top,bx:bx};};var api={};api.newPM=function(opt){opt=opt||{};return{ver:'0.0.0',down:false,angle:0,dist:0,PPS:0,maxPPS:opt.maxPPS===undefined?128:opt.maxPPS,sp:{x:-1,y:-1},cp:{x:-1,y:-1}};};api.updatePM=function(pm){pm.dist=0;pm.PPS=0;pm.angle=0;if(pm.cp.x>=0&&pm.cp.y>=0){pm.dist=distance(pm.sp.x,pm.sp.y,pm.cp.x,pm.cp.y);} if(pm.down&&pm.dist>=5){var per=pm.dist/64;per=per>1?1:per;per=per<0?0:per;pm.PPS=per*pm.maxPPS;pm.angle=Math.atan2(pm.cp.y-pm.sp.y,pm.cp.x-pm.sp.x);}};api.stepPointByPM=function(pm,pt,secs){secs=secs===undefined?1:secs;pt.x+=Math.cos(pm.angle)*pm.PPS*secs;pt.y+=Math.sin(pm.angle)*pm.PPS*secs;};api.onPointerStart=function(pm,e){var pos=getCanvasRelative(e);pm.down=true;pm.sp={x:pos.x,y:pos.y};};api.onPointerMove=function(pm,e){var pos=getCanvasRelative(e);pm.cp={x:pos.x,y:pos.y};};api.onPointerEnd=function(pm,e){var pos=getCanvasRelative(e);pm.down=false;pm.sp={x:-1,y:-1};pm.cp={x:-1,y:-1};};return api;} ());var draw={};draw.background=function(pm,ctx,canvas){ctx.fillStyle='black';ctx.fillRect(0,0,canvas.width,canvas.height);};draw.PTGridlines=function(pt,ctx,canvas){var cellX=-1,cellY=-1,x,y;ctx.strokeStyle='gray';ctx.lineWidth=1;while(cellX<11){x=cellX*32-pt.x%32;ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,canvas.height);ctx.stroke();cellX+=1;} while(cellY<8){y=cellY*32-pt.y%32;ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(canvas.width,y);ctx.stroke();cellY+=1;}};draw.navCircle=function(pm,ctx,canvas){if(pm.down){var cx=pm.sp.x,cy=pm.sp.y,x,y,min=64,per=0,a=pm.angle;ctx.strokeStyle='white';ctx.lineWidth=3;ctx.beginPath();ctx.arc(cx,cy,min/2,0,Math.PI*2);ctx.stroke();x=Math.cos(a)*min+cx;y=Math.sin(a)*min+cy;ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(x,y);ctx.stroke();per=pm.PPS/pm.maxPPS;x=Math.cos(a)*min*per+cx;y=Math.sin(a)*min*per+cy;ctx.beginPath();ctx.arc(x,y,10,0,Math.PI*2);ctx.stroke();}};draw.debugInfo=function(pm,pt,ctx,canvas){ctx.fillStyle='white';ctx.fillText('pos: '+Math.floor(pt.x)+', '+Math.floor(pt.y),10,10);ctx.fillText('PPS: '+pm.PPS.toFixed(2)+'/'+pm.maxPPS,10,20);};draw.ver=function(ctx,pm){ctx.fillStyle='white';ctx.font='10px courier';ctx.textBaseline='top';ctx.textAlign='left';ctx.fillText('v'+pm.ver,5,canvas.height-15);};var canvas=document.createElement('canvas'),ctx=canvas.getContext('2d'),container=document.getElementById('canvas-app')||document.body;container.appendChild(canvas);canvas.width=320;canvas.height=240;ctx.translate(0.5,0.5);var pm=PM.newPM({maxPPS:256});var pt={x:0,y:0};var lt=new Date();var loop=function(){var now=new Date(),t=now-lt,secs=t/1000;requestAnimationFrame(loop);PM.updatePM(pm);PM.stepPointByPM(pm,pt,secs);draw.background(pm,ctx,canvas);draw.PTGridlines(pt,ctx,canvas);draw.navCircle(pm,ctx,canvas);draw.debugInfo(pm,pt,ctx,canvas);draw.ver(ctx,pm);lt=now;};loop();canvas.addEventListener('mousedown',function(e){PM.onPointerStart(pm,e);});canvas.addEventListener('mousemove',function(e){PM.onPointerMove(pm,e);});canvas.addEventListener('mouseup',function(e){PM.onPointerEnd(pm,e);});canvas.addEventListener('touchstart',function(e){PM.onPointerStart(pm,e);});canvas.addEventListener('touchmove',function(e){PM.onPointerMove(pm,e);});canvas.addEventListener('touchend',function(e){PM.onPointerEnd(pm,e);});</script>
</body></html>