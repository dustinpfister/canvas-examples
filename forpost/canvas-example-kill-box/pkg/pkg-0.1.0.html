<html><head><title>canvas example kill box</title></head><body>
<div id="canvas-app"style="width:320px;height:240px;margin-left:auto;margin-right:auto;"></div>
<script>var utils={};utils.boundingBox=function(a,b){return!((a.y+a.h)<b.y||a.y>(b.y+b.h)||(a.x+a.w)<b.x||a.x>(b.x+b.w));};utils.getCanvasRelative=function(e){var canvas=e.target,bx=canvas.getBoundingClientRect();return{x:(e.changedTouches?e.changedTouches[0].clientX:e.clientX)-bx.left,y:(e.changedTouches?e.changedTouches[0].clientY:e.clientY)-bx.top,bx:bx};};var poolMod=(function(){return{create:function(opt){opt=opt||{};opt.count=opt.count||10;var i=0,pool=[];while(i<opt.count){pool.push({active:false,x:opt.x===undefined?0:opt.x,y:opt.y===undefined?0:opt.y,w:opt.w===undefined?32:opt.w,h:opt.h===undefined?32:opt.h,heading:opt.heading===undefined?0:opt.heading,pps:32,lifespan:opt.lifespan||3,data:{},spawn:opt.spawn||function(obj,state){},purge:opt.purge||function(obj,state){},update:opt.update||function(obj,state,secs){obj.lifespan-=secs;}});i+=1;} return pool;},spawn:function(pool,game,opt){var i=pool.length,obj;while(i--){obj=pool[i];if(!obj.active){obj.active=true;obj.spawn.call(obj,obj,game,opt);return obj;}} return false;},update:function(pool,secs,state){var i=pool.length,obj;state=state||{};while(i--){obj=pool[i];if(obj.active){obj.update(obj,state,secs);obj.lifespan=obj.lifespan<0?0:obj.lifespan;if(obj.lifespan===0){obj.active=false;obj.purge.call(obj,obj,state);}}}},setActiveStateForAll:function(pool,bool){bool=bool===undefined?false:bool;var i=pool.length,obj;while(i--){obj=pool[i];obj.active=bool;}}}} ());var gameMod=(function(){var enemyPoolOptions={count:5,spawn:function(enemy){enemy.x=128;enemy.y=0;}};var playerPoolOptions={count:5,spawn:function(enemy){enemy.x=128;enemy.y=200;}};var shotPoolOptions={count:10,w:5,h:5,spawn:function(enemy){enemy.x=0;enemy.y=0;}};return{create:function(opt){var game={enemies:[],playerUnits:[],shots:[]};game.enemies=poolMod.create(enemyPoolOptions);game.playerUnits=poolMod.create(playerPoolOptions);game.shots=poolMod.create(shotPoolOptions);console.log(game);poolMod.spawn(game.enemies);poolMod.spawn(game.playerUnits);poolMod.spawn(game.shots);return game;}}} ());var draw=(function(){return{back:function(ctx,canvas){ctx.fillStyle='black';ctx.fillRect(0,0,canvas.width,canvas.height);},pool:function(sm,poolName,fill){var pool=sm.game[poolName],unit,i=pool.length;while(i--){unit=pool[i];if(unit.active){ctx.fillStyle=fill||'white';ctx.fillRect(unit.x,unit.y,unit.w,unit.h);}}},cursor:function(sm){var ctx=sm.ctx;ctx.strokeStyle='lime';ctx.lineWidth=3;ctx.beginPath();ctx.arc(sm.input.pos.x,sm.input.pos.y,5,0,Math.PI*2);ctx.stroke();},ver:function(sm){var ctx=sm.ctx;ctx.fillStyle='lime';ctx.textBaseline='top';ctx.font='10px arial';ctx.fillText('v'+sm.ver,2,sm.canvas.height-12);}}} ());var states={game:{update:function(sm,secs){draw.back(ctx,canvas);draw.pool(sm,'enemies','red');draw.pool(sm,'playerUnits','blue');draw.pool(sm,'shots','white');draw.cursor(sm);draw.ver(sm);},pointerStart:function(sm,e){},pointerMove:function(){},pointerEnd:function(){}}};var canvas=document.createElement('canvas'),ctx=canvas.getContext('2d'),container=document.getElementById('canvas-app')||document.body;container.appendChild(canvas);canvas.width=320;canvas.height=240;ctx.translate(0.5,0.5);var sm={ver:'0.1.0',canvas:canvas,ctx:ctx,currentState:'game',game:gameMod.create({canvas:canvas}),input:{pointerDown:false,pos:{x:0,y:0}}};var pointerHanders={start:function(sm,e){var pos=sm.input.pos;sm.input.pointerDown=true;sm.input.pos=utils.getCanvasRelative(e);states[sm.currentState].pointerStart(sm,e);},move:function(sm,e){if(sm.input.pointerDown){sm.input.pos=utils.getCanvasRelative(e);states[sm.currentState].pointerMove(sm,e);}},end:function(sm,e){sm.input.pointerDown=false;states[sm.currentState].pointerEnd(sm,e);}};var createPointerHandler=function(sm,type){return function(e){e.preventDefault();pointerHanders[type](sm,e);};};canvas.addEventListener('mousedown',createPointerHandler(sm,'start'));canvas.addEventListener('mousemove',createPointerHandler(sm,'move'));canvas.addEventListener('mouseup',createPointerHandler(sm,'end'));canvas.addEventListener('touchstart',createPointerHandler(sm,'start'));canvas.addEventListener('touchmove',createPointerHandler(sm,'move'));canvas.addEventListener('touchend',createPointerHandler(sm,'end'));var lt=new Date(),FPS_target=30;var loop=function(){var now=new Date(),t=now-lt,secs=t/1000;requestAnimationFrame(loop);if(t>=1000/FPS_target){states[sm.currentState].update(sm,secs);lt=now;}};loop();</script>
</body></html>