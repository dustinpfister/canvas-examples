<html>
    <head>
        <title>canvas example object pool</title>
    </head>
    <body>
<div id="canvas-app" style="width:320px;height:240px;margin-left:auto;margin-right:auto;"></div>
<script>var Pool=(function(){var createPool=function(){var state={ver:'0.1.0',pool:[],spawnRate:0.1,secs:0,colors:['red','green','blue']};var i=50;while(i--){state.pool.push({x:32,y:32,w:32,h:32,heading:0,pps:64,lifespan:3,hcps:0,alpha:0.5,fill:state.colors[i%state.colors.length],active:false});}return state;};var spawn=function(state,secs){var bx;state.secs+=secs;if(state.secs>=state.spawnRate){bx=getInactive(state.pool);if(bx){bx.active=true;bx.x=canvas.width/2;bx.y=canvas.height/2;bx.heading=Math.PI*2*Math.random();bx.pps=32+128*Math.random();bx.hcps=-90+180*Math.random();bx.lifespan=10;}state.secs%=state.spawnRate;}};update=function(state,secs){var i=state.pool.length,bx;while(i--){bx=state.pool[i];if(bx.active){bx.x+=Math.cos(bx.heading)*bx.pps*secs;bx.y+=Math.sin(bx.heading)*bx.pps*secs;bx.heading+=Math.PI/180*bx.hcps*secs;bx.lifespan-=secs;bx.lifespan=bx.lifespan<0?0:bx.lifespan;if(bx.lifespan===0){bx.hcps=0;}}checkBounds(bx,canvas);}spawn(state,secs);};var getInactive=function(pool){var p=state.player,i=pool.length,obj;while(i--){obj=pool[i];if(!obj.active){return obj;}}return false;};var checkBounds=function(bx,canvas){if(bx.x>=canvas.width||bx.x<bx.w* -1||bx.y>canvas.height||bx.y<bx.h* -1){bx.active=false;}};return{create:createPool,update:update}}());var draw={};draw.back=function(ctx,canvas){ctx.fillStyle='black';ctx.fillRect(0,0,canvas.width,canvas.height);};draw.pool=function(ctx,state){var i=state.pool.length,bx;ctx.fillStyle='white';ctx.strokeStyle='black';ctx.lineWidth=3;while(i--){bx=state.pool[i];if(bx.active){ctx.save();ctx.fillStyle=bx.fill;ctx.globalAlpha=bx.alpha;ctx.translate(bx.x,bx.y);ctx.rotate(bx.heading);ctx.beginPath();ctx.rect(bx.w/2* -1,bx.h/2* -1,bx.w,bx.h);ctx.fill();ctx.stroke();ctx.restore();}}};draw.info=function(ctx,state){ctx.font='10px couriter';ctx.fillStyle='white';ctx.fillText('v'+state.ver,5,15);};var container=document.getElementById('canvas-app'),canvas=document.createElement('canvas'),ctx=canvas.getContext('2d');canvas.width=320;canvas.height=240;container.appendChild(canvas);var state=Pool.create();var lt=new Date();var loop=function(){var now=new Date(),t=now-lt,secs=t/1000;requestAnimationFrame(loop);draw.back(ctx,canvas);draw.pool(ctx,state);draw.info(ctx,state);Pool.update(state,secs);lt=now;};loop();</script>
    </body>
</html>