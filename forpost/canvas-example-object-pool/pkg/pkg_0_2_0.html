<html><head><title>canvas example object pool</title></head><body>
<div id="canvas-app"style="width:320px;height:240px;margin-left:auto;margin-right:auto;"></div>
<script>var poolMod=(function(){var api={};var getInactive=function(pool){var i=pool.objects.length,obj;while(i--){obj=pool.objects[i];if(!obj.active){return obj;}} return false;};api.create=function(opt){opt=opt||{};opt.count=opt.count||10;var i=0,pool={objects:[],data:opt.data||{},spawn:opt.spawn||function(obj,state){},purge:opt.purge||function(obj,state){},update:opt.update||function(obj,state,secs){}};while(i<opt.count){pool.objects.push({active:false,i:i,x:opt.x===undefined?0:opt.x,y:opt.y===undefined?0:opt.y,w:opt.w===undefined?32:opt.w,h:opt.h===undefined?32:opt.h,heading:opt.heading===undefined?0:opt.heading,pps:opt.pps===undefined?32:opt.pps,lifespan:opt.lifespan||3,data:opt.data||{}});i+=1;} return pool;};api.spawn=function(pool,state,opt){var obj=getInactive(pool);state=state||{};opt=opt||{};if(obj){if(!obj.active){obj.active=true;pool.spawn.call(pool,obj,pool,state,opt);return obj;}} return false;};api.update=function(pool,secs,state){var i=pool.objects.length,obj;state=state||{};while(i--){obj=pool.objects[i];if(obj.active){pool.update.call(pool,obj,pool,state,secs);obj.lifespan-=secs;obj.lifespan=obj.lifespan<0?0:obj.lifespan;if(obj.lifespan===0){obj.active=false;pool.purge.call(pool,obj,pool,state);}}}};api.setActiveStateForAll=function(pool,bool){bool=bool===undefined?false:bool;var i=pool.objects.length,obj;while(i--){obj=pool.objects[i];obj.active=bool;}};return api;} ());var draw={};draw.back=function(ctx,canvas){ctx.fillStyle='black';ctx.fillRect(0,0,canvas.width,canvas.height);};draw.pool=function(ctx,pool){var i=pool.objects.length,bx;ctx.fillStyle='white';ctx.strokeStyle='black';ctx.lineWidth=3;while(i--){bx=pool.objects[i];if(bx.active){ctx.save();ctx.fillStyle=bx.fill;ctx.globalAlpha=bx.alpha;ctx.translate(bx.x,bx.y);ctx.rotate(bx.heading);ctx.beginPath();ctx.rect(bx.w/2* -1,bx.h/2* -1,bx.w,bx.h);ctx.fill();ctx.stroke();ctx.restore();}}};draw.ver=function(ctx,state){ctx.font='10px couriter';ctx.fillStyle='white';ctx.fillText('v'+state.ver,5,15);};var container=document.getElementById('canvas-app'),canvas=document.createElement('canvas'),ctx=canvas.getContext('2d');canvas.width=320;canvas.height=240;container.appendChild(canvas);var checkBounds=function(obj,canvas){if(obj.x>=canvas.width||obj.x<obj.w* -1||obj.y>canvas.height||obj.y<obj.h* -1){obj.active=false;}};var state={ver:'0.2.0',canvas:canvas,secs:0,spawnRate:0.1,boxes:poolMod.create({count:5,data:{colors:['red','green','blue'],},spawn:function(obj,pool,state,opt){obj.x=state.canvas.width/2;obj.y=state.canvas.height/2;obj.heading=Math.PI*2*Math.random();obj.pps=32+128*Math.random();obj.hcps=-90+180*Math.random();obj.lifespan=10;obj.fill=pool.data.colors[obj.i%pool.data.colors.length]},update:function(obj,pool,state,secs){if(obj.active){obj.x+=Math.cos(obj.heading)*obj.pps*secs;obj.y+=Math.sin(obj.heading)*obj.pps*secs;obj.heading+=Math.PI/180*obj.hcps*secs;} checkBounds(obj,state.canvas);}})};var lt=new Date();var loop=function(){var now=new Date(),t=now-lt,secs=t/1000;requestAnimationFrame(loop);draw.back(ctx,canvas);draw.pool(ctx,state.boxes);draw.ver(ctx,state);poolMod.update(state.boxes,secs,state);state.secs+=secs;if(state.secs>=state.spawnRate){poolMod.spawn(state.boxes,state);state.secs%=state.spawnRate;} lt=now;};loop();</script>
</body></html>