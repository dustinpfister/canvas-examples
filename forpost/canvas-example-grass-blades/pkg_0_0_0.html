<html>
    <head>
        <title>canvas example grass blades</title>
    </head>
    <body style="margin:0px;">
<div id="canvas-app" style="width:320px;height:240px;margin-left:auto;margin-right:auto;"></div>
<script>var Blade=(function(){var createPoints=function(blade,ptCount){var points=[],bp=blade.basePos,i=0,a,x=bp.x,y=bp.y;aDelta=Math.PI/180*blade.turn;while(i<ptCount){a=Math.PI*1.5+aDelta/(ptCount-2)*i;points.push({x:x,y:y});x+=Math.cos(a)*blade.segLength;y+=Math.sin(a)*blade.segLength;i+=1;}return points;};return{create:function(opt){opt=opt||{};opt.ptCount=opt.ptCount||24;opt.canvas=opt.canvas||{width:320,heigh:240};opt.baseX=opt.baseX===undefined?canvas.width/2:opt.baseX;var blade={basePos:{y:canvas.height,x:opt.baseX},r:opt.g===undefined?0:opt.r,g:opt.g===undefined?255:opt.g,b:opt.g===undefined?0:opt.b,width:{min:opt.widthMin||3,max:opt.widthMax||20},turn:opt.turn===undefined?0:opt.turn,segLength:opt.segLength===undefined?10:opt.segLength,points:[],t:opt.t===undefined?0:opt.t,tMax:opt.tMax===undefined?0:opt.tMax};blade.points=createPoints(blade,opt.ptCount);return blade;}};}());var Grass=(function(){return{create:function(opt){opt=opt||{};return{ver:'0.0.0',maxBlades:opt.maxBlades||10,spawnRate:opt.spawnRate||300,canvas:opt.canvas||{width:320,heigh:240},t:0,blades:[]};},update:function(grass,t){grass.t+=t;grass.blades.forEach(function(blade){blade.t+=t;blade.t=blade.t>blade.tMax?blade.tMax:blade.t;});if(grass.t>=grass.spawnRate){if(grass.blades.length>=grass.maxBlades){grass.blades.shift();}grass.blades.push(Blade.create({r:100+Math.floor(156*Math.random()),g:100+Math.floor(156*Math.random()),b:100+Math.floor(156*Math.random()),baseX:Math.floor(grass.canvas.width*Math.random()),turn:-180+360*Math.random(),tMax:1000+Math.floor(20000*Math.random()),ptCount:20+Math.floor(30*Math.random()),segLength:5,widthMin:1,widthMax:5}));grass.t%=grass.spawnRate;}}}}());var draw=(function(){var drawBlade=function(ctx,blade,style){var i=1,per,len=Math.floor((blade.t/blade.tMax)*blade.points.length),pt=blade.points[0];ctx.strokeStyle=style||'lime';while(i<len){ctx.beginPath();ctx.moveTo(pt.x,pt.y);pt=blade.points[i];per=i/len;ctx.lineWidth=Math.floor(blade.width.min+blade.width.max-blade.width.max*per);ctx.lineTo(pt.x,pt.y);ctx.stroke();i+=1;}};return{background:function(ctx,canvas){ctx.fillStyle='black';ctx.fillRect(0,0,canvas.width,canvas.height);},blade:drawBlade,grass:function(ctx,grass){grass.blades.forEach(function(blade,i){var style='rgba('+blade.r+','+blade.g+','+blade.b+','+(0.1+0.9*(i/grass.blades.length))+')';drawBlade(ctx,blade,style);})},info:function(ctx,canvas,grass){ctx.fillStyle='grey';ctx.textBaseline='top';ctx.font='10px courier';ctx.textAlign='left';ctx.fillText('v'+grass.ver,10,canvas.height-15);}}}());var canvas=document.createElement('canvas'),ctx=canvas.getContext('2d'),container=document.getElementById('canvas-app')||document.body;container.appendChild(canvas);canvas.width=320;canvas.height=240;ctx.translate(0.5,0.5);var g=Grass.create({maxBlades:200,canvas:canvas});var lt=new Date();var loop=function(){var now=new Date(),t=now-lt;requestAnimationFrame(loop);draw.background(ctx,canvas);Grass.update(g,t);draw.grass(ctx,g);draw.info(ctx,canvas,g);lt=now;};loop();</script>
    </body>
</html>