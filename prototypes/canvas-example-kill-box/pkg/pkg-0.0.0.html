<html><head><title>canvas example kill box</title></head><body><div id="canvas-app"style="width:320px;height:240px;margin-left:auto;margin-right:auto;"></div><script>var utils={};utils.boundingBox=function(a,b){return!((a.y+a.h)<b.y||a.y>(b.y+b.h)||(a.x+a.w)<b.x||a.x>(b.x+b.w));};utils.getCanvasRelative=function(e){var canvas=e.target,bx=canvas.getBoundingClientRect();return{x:(e.changedTouches?e.changedTouches[0].clientX:e.clientX)-bx.left,y:(e.changedTouches?e.changedTouches[0].clientY:e.clientY)-bx.top,bx:bx};};var gameMod=(function(){return{create:function(opt){return{};}}}());var draw=(function(){return{back:function(ctx,canvas){ctx.fillStyle='black';ctx.fillRect(0,0,canvas.width,canvas.height);},cursor:function(sm){var ctx=sm.ctx;ctx.strokeStyle='lime';ctx.lineWidth=3;ctx.beginPath();ctx.arc(sm.input.pos.x,sm.input.pos.y,5,0,Math.PI*2);ctx.stroke();},ver:function(sm){var ctx=sm.ctx;ctx.fillStyle='lime';ctx.textBaseline='top';ctx.font='10px arial';ctx.fillText('v'+sm.ver,2,sm.canvas.height-12);}}}());var states={game:{update:function(sm,secs){draw.back(ctx,canvas);draw.cursor(sm);draw.ver(sm);},pointerStart:function(sm,e){},pointerMove:function(){},pointerEnd:function(){}}};var canvas=document.createElement('canvas'),ctx=canvas.getContext('2d'),container=document.getElementById('canvas-app')||document.body;container.appendChild(canvas);canvas.width=320;canvas.height=240;ctx.translate(0.5,0.5);var sm={ver:'0.0.0',canvas:canvas,ctx:ctx,currentState:'game',game:gameMod.create({canvas:canvas}),input:{pointerDown:false,pos:{x:0,y:0}}};var pointerHanders={start:function(sm,e){var pos=sm.input.pos;sm.input.pointerDown=true;sm.input.pos=utils.getCanvasRelative(e);states[sm.currentState].pointerStart(sm,e);},move:function(sm,e){if(sm.input.pointerDown){sm.input.pos=utils.getCanvasRelative(e);states[sm.currentState].pointerMove(sm,e);}},end:function(sm,e){sm.input.pointerDown=false;states[sm.currentState].pointerEnd(sm,e);}};var createPointerHandler=function(sm,type){return function(e){e.preventDefault();pointerHanders[type](sm,e);};};canvas.addEventListener('mousedown',createPointerHandler(sm,'start'));canvas.addEventListener('mousemove',createPointerHandler(sm,'move'));canvas.addEventListener('mouseup',createPointerHandler(sm,'end'));canvas.addEventListener('touchstart',createPointerHandler(sm,'start'));canvas.addEventListener('touchmove',createPointerHandler(sm,'move'));canvas.addEventListener('touchend',createPointerHandler(sm,'end'));var lt=new Date(),FPS_target=30;var loop=function(){var now=new Date(),t=now-lt,secs=t/1000;requestAnimationFrame(loop);if(t>=1000/FPS_target){states[sm.currentState].update(sm,secs);lt=now;}};loop();</script></body></html>